<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <link href='css/mvstored.css' rel='stylesheet' type='text/css' />
  <script src='js/jquery.js' type='text/javascript'></script>
  <script src='js/persist-min.js' type='text/javascript'></script>
  <script src='js/mvstored.js' type='text/javascript'></script>
  <title>mvStore Console</title>
</head>
<body>

<div id='left'>
  <div id='logo'><img src='images/mvlogo.png' alt='mvstore logo' id='logo_img'></div>
  <div id='nav'>
    <ul>
      <li><a href="#tab-basic"><img src='images/basic.png'></a></li>
      <li><a href="#tab-batching"><img src='images/batch.png'></a></li>
      <li><a href="#tab-tutorial"><img src='images/tutorial.png'></a></li>
      <li><a href="#tab-queryhistory"><img src='images/history.png'></a></li>
      <li><a href="#tab-config"><img src='images/config.png'></a></li>
    </ul>
  </div>
</div>

<div id='content'>
  <!-- Basic Console -->
  <div id="tab-basic">
    <div id='content_title'>
      <h1>Basic Console</h1>
    </div>
    <div id='content_left'>
      <div id='query_spec'>
        <form id='form' method="get" action="/db">
          <input id='query' name='query' />
          <button id='querygo'> go </button>
          <select name="type" id='querytype'>
            <option value="query">query</option>
            <option value="expression">expression</option>
            <option value="count">count</option>
            <option value="plan">plan</option>
            <option value="display">display</option>
          </select>
        </form>
        <br/>
      </div>
      <div id='result_frame'>
        <div id='result_list'></div>
        <div id='result_pin'>Execute a query and select a row to see PIN details.</div>
      </div>
    </div>
    <div id='content_right'>
      <h3>Classes</h3>
      <select name="classes" id="classes" size="5"></select>
      <br/>
      <p id='class_doc'></p>
      <h3>Properties</h3>
      <select name="class_properties" id="class_properties" size="5"></select>
      <br/>
      <p id='property_doc'></p>
      <h3>QName Prefixes</h3>
      <select name="qnames" id="qnames" size="5"></select>
    </div>
  </div>
  <!-- Batching Console -->
  <div id="tab-batching">
    <div id='content_title'>
      <h1>Batching Console</h1>
    </div>
    <div id='batching_left'>
      <div id='query_area'>
        <textarea id='query_area_q' cols=10></textarea>
        <button id='query_area_go'>go</button>
        <div id='query_area_warning'>
          <p>
          WARNING:<br>
          &nbsp;Presently, statements are not guaranteed to be executed in a single stream; transactions may not be respected.<br>
          &nbsp;Some browsers provide a means of avoiding this issue (e.g. in firefox, via about:config, set network.http.max-persistent-connections-per-server=1).
          </p>
        </div>
      </div>
      <div id='result_area'>
        <select name='results' id='result_area_selector'>
          <option value="none">none</option>
        </select>
        <div id='result_area_page'></div>
      </div>
    </div>
  </div>
  <!-- Tutorial Console -->
  <div id="tab-tutorial">
    <div id='content_title'>
      <h1>Interactive Tutorial (JS)</h1>
    </div>
    <div id='tutorial_left'>
      <div id='tutorial_area'>
        <div id='tutorial_history'>
          <p>Welcome to mvStore 1.0</p>
          <br>
          <p>h: print the help</p>
          <p>t: start the interactive tutorial</p>
          <br>
        </div>
        <div id='tutorial_input_line'>&gt;<input id='tutorial_input' /></div>
      </div>
    </div>
  </div>
  <!-- Query History -->
  <div id="tab-queryhistory">
    <div id='content_title'>
      <h1>Query History</h1>
    </div>
    <div id='content_left'>
      <div id='query_history'></div>
    </div>
    <div id='content_right'>
      <button id='query_history_clear'>Clear History</button>
    </div>
  </div>
  <!-- Configuration & Administration -->
  <div id="tab-config">
    <div id='content_title'>
      <h1>Configuration &amp; Administration</h1>
    </div>
    <div id='content_left'>
      <div id='config_options'>
        <h3>Current Store Name</h3>
        <input id='storeident' name='storeident' size='25' />
        <h3>Current Store Password</h3>
        <input id='storepw' name='storepw' size='25' />
      </div>
    </div>
  </div>
</div>

<div id='bottom'>mvStore</div>

<!--
  #thetooltip is recycled throughout the whole UI, to display a tooltip wherever we want;
  #thetooltiptable and #themenutable are used as string tables; does there exist a more orthodox solution?
-->
<div id='thetooltip'>tooltip</div>
<div id='thetooltiptable'>
  <div id='manual'> <!-- These are bound manually by the js code. -->
    <div id='tooltip_tab-basic'>Basic Console</div>
    <div id='tooltip_tab-batching'>Batching Console</div>
    <div id='tooltip_tab-tutorial'>Interactive Tutorial</div>
    <div id='tooltip_tab-queryhistory'>Query History</div>
    <div id='tooltip_tab-config'>Configuration &amp; Administration</div>
  </div>
  <div id='automatic'> <!-- These are bound automatically to components of the same name in the page. -->
    <div id='tooltip_classes'>Stored Classes (Right-Click)</div>
    <div id='tooltip_class_properties'>Properties of Selected Class (Right-Click)</div>
    <div id='tooltip_qnames'>QName Prefixes</div>
    <div id='tooltip_query'>Next Query (Press 'go' or Right-Click)</div>
    <div id='tooltip_result_pin'>Last Selected PIN</div>
    <div id='tooltip_query_history'>Click or Right-Click on Row</div>
    <div id='tooltip_query_area_q'>Next Batch of Queries (Press 'go')</div>
    <div id='tooltip_result_area_selector'>Select Query Result</div>
    <div id='tooltip_storeident'>Store Name (aka Identity)</div>
    <div id='tooltip_storepw'>Store Password (may be empty)</div>
  </div>
</div>
<div id='themenutable'>
  <div id='menu_query'>
    <div id='menuitem_query_pin'>Query PIN</div>
    <div id='menuitem_query_class'>Query Class</div>
    <div id='menuitem_query_classft'>Query Class With Full-Text</div>
    <div id='menuitem_query_classjoin'>Query Class Join</div>
    <div id='menuitem_query_all'>Query All PINs</div>
    <div id='menuitem_query_insertpin'>Insert PIN</div>
    <div id='menuitem_query_insertgraph'>Insert Graph</div>
    <div id='menuitem_query_insertclass'>Insert Class</div>
    <div id='menuitem_query_updatepin'>Update PIN</div>
    <div id='menuitem_query_deletepin'>Delete PIN</div>
    <div id='menuitem_query_dropclass'>Drop Class</div>
  </div>
  <div id='menu_classes'>
    <div id='menuitem_classes_q'>Query Class</div>
    <div id='menuitem_classes_q_ft'>Query Class With Full-Text</div>
    <div id='menuitem_classes_q_drop'>Drop Class</div>
  <div id='menu_result_pin'>
    <div id='menuitem_rp_querypin'>Query PIN</div>
    <div id='menuitem_rp_deletepin'>Delete PIN</div>
  </div>
  <div id='menu_query_history'>
    <div id='menuitem_qh_remove'>Remove</div>
    <div id='menuitem_qh_setquery'>Set As Next Query</div>
  </div>
</div>
<div id='thetutorial'>
  <div id='help'>
    <div>HELP</div>
    <div>Note: This is a simplified interface for introductory purpose.</div>
    <div>&nbsp;</div>
    <div>h: print this help</div>
    <div>t: start the tutorial</div>
    <div>n: go to next step of the tutorial</div>
    <div>step(number): jump to step 'number' of the tutorial</div>
    <div>&nbsp;</div>
    <div>mvsql(sqlstr): execute 'sqlstr' and return json</div>
    <div>save(json): create or update objects in the db</div>
    <div>print(v): print the value of 'v'</div>
  </div>
  <div id='steps'>
    <div id='step0'>
      <div>This is a quick, simple tutorial about mvStore.</div>
      <div>Note: All examples can be cut&amp;pasted as one line, or as multiple lines.</div>
      <div>step(number): jump to step 'number'</div>
      <div>n: move forward</div>
    </div>
    <div id='step1'>
      <div>Step 1</div>
      <div>This shell provides a programming environment in javascript.</div>
      <div>It emulates what you'll experience in the language of your choice, using one of mvStore's client libraries.</div>
      <div>Try this simple text manipulation for example:</div>
      <div>&nbsp;</div>
      <div>phrase="hello world";</div>
      <div>print(phrase);</div>
      <div>for (i in phrase) { print("letter: " + phrase[i]); }</div>
    </div>
    <div id='step2'>
      <div>Step 2</div>
      <div>Try this object manipulation (we'll save this object later on):</div>
      <div>&nbsp;</div>
      <div>object = {name:'Jack', profession:'Doctor'};</div>
      <div>for (i in object) { print(i + ":" + object[i]); }</div>
    </div>
    <div id='step3'>
      <div>Step 3</div>
      <div>The mvsql() function opens up the whole sql-based side of the interaction.</div>
      <div>Try this for example:</div>
      <div>&nbsp;</div>
      <div>pins = mvsql("INSERT name='Steve', profession='Engineer';");</div>
      <div>print("resulting pin id:" + pins[0].id);</div>
      <div>print("retrieving the resulting pin by id");</div>
      <div>mvsql("SELECT * FROM @" + pins[0].id + ";");</div>
      <div>print("retrieving the resulting pin by some search criterion");</div>
      <div>mvsql("SELECT * WHERE EXISTS(name) MATCH AGAINST('Ste');");</div>
    </div>
    <div id='step4'>
      <div>Step 4</div>
      <div>The mvsql DML can be pretty fancy and powerful.</div>
      <div>Try this for example:</div>
      <div>&nbsp;</div>
      <div>mvsql("INSERT name='John', profession='Lawyer', friend=(INSERT name='Fred', profession='Musician');");</div>
      <div>mvsql("SELECT * WHERE EXISTS(name);");</div>
    </div>
    <div id='step5'>
      <div>Step 5</div>
      <div>Now that you have some data, how about we organize it a little bit.</div>
      <div>Try this:</div>
      <div>&nbsp;</div>
      <div>mvsql("CREATE CLASS workers AS SELECT * WHERE EXISTS(name) AND profession IN :0;");</div>
      <div>mvsql("SELECT * FROM workers;");</div>
      <div>mvsql("SELECT * FROM workers('Musician');");</div>
    </div>
    <div id='step6'>
      <div>Step 6</div>
      <div>Path expressions let you do pretty fancy graph navigation.</div>
      <div>Here's a very simple example:</div>
      <div>&nbsp;</div>
      <div>friends = mvsql("SELECT * FROM workers.friend;");</div>
      <div>for (i = 0; i &lt; friends.length; i++) print("friend of a worker: " + friends[i].name + " (" + friends[i].id + ")");</div>
    </div>
    <div id='step7'>
      <div>Step 7</div>
      <div>Remember the plain javascript object we had created at step 2? Let's save it...</div>
      <div>Notice the new 'id' attribute after the save.</div>
      <div>Note: With our client interfaces this is achieved transparently via protocol buffers. Here the implementation is an emulation using mvSQL.</div>
      <div>&nbsp;</div>
      <div>if (object != undefined) { print(object); save(object); print(object); }</div>
    </div>
    <div id='step8'>
      <div>Step 8</div>
      <div>Now that our object has an id, we can modify it.</div>
      <div>&nbsp;</div>
      <div>if (object != undefined) { object.mystring = 'hello world'; object.mycollection = [1, 2, 3, 4, 5]; object.mydate = new Date(); save(object); }</div>
      <div>mvsql("SELECT * WHERE EXISTS(mystring);");</div>
    </div>
  </div>
  <div id='restart'>End of tutorial. Type t to restart. Or go and download mvStore!</div>
</div>
</body>
</html>
