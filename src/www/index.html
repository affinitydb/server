<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <link href='css/mvstored.css' rel='stylesheet' type='text/css' />
  <script src='js/jquery.js' type='text/javascript'></script>
  <script src='js/persist-min.js' type='text/javascript'></script>
  <script src='js/mvstored.js' type='text/javascript'></script>
  <title>mvStore Console</title>
</head>
<body>

<div id='left'>
  <div id='logo'><img src='images/mvlogo.png' alt='mvstore logo' id='logo_img'></div>
  <div id='nav'>
    <ul>
      <li><a href="#tab-tutorial"><img src='images/tutorial.png'></a></li>
      <li><a href="#tab-basic"><img src='images/basic.png'></a></li>
      <li><a href="#tab-batching"><img src='images/batch.png'></a></li>
      <li><a href="#tab-queryhistory"><img src='images/history.png'></a></li>
      <li><a href="#tab-config"><img src='images/config.png'></a></li>
    </ul>
  </div>
</div>

<div id='content'>
  <div id="mvdoc">
    <a href="doc/intro.html">doc</a>
  </div>
  <!-- Basic Console -->
  <div id="tab-basic">
    <div id='content_title'>
      <h1>Basic Console</h1>
    </div>
    <div id='content_left'>
      <div id='query_spec'>
        <form id='form' method="get" action="/db">
          <input id='query' name='query' />
          <button id='querygo'> go </button>
          <select name="type" id='querytype'>
            <option value="query">query</option>
            <option value="expression">expression</option>
            <option value="count">count</option>
            <option value="plan">plan</option>
            <option value="display">display</option>
          </select>
        </form>
        <br/>
      </div>
      <div id='result_frame'>
        <div id='result_list'></div>
        <div id='result_pin'>Execute a query and select a row to see PIN details.</div>
      </div>
    </div>
    <div id='content_right'>
      <h3>Classes</h3>
      <select name="classes" id="classes" size="5"></select>
      <br/>
      <p id='class_doc'></p>
      <h3>Properties</h3>
      <select name="class_properties" id="class_properties" size="5"></select>
      <br/>
      <p id='property_doc'></p>
      <h3>QName Prefixes</h3>
      <select name="qnames" id="qnames" size="5"></select>
    </div>
  </div>
  <!-- Batching Console -->
  <div id="tab-batching">
    <div id='content_title'>
      <h1>Batching Console</h1>
    </div>
    <div id='batching_left'>
      <div id='query_area'>
        <textarea id='query_area_q' cols=10></textarea>
        <button id='query_area_go'>go</button>
        <div id='query_area_warning'>
          <p>
          WARNING:<br>
          &nbsp;Presently, statements are not guaranteed to be executed in a single stream; transactions may not be respected.<br>
          &nbsp;Some browsers provide a means of avoiding this issue (e.g. in firefox, via about:config, set network.http.max-persistent-connections-per-server=1).
          </p>
        </div>
      </div>
      <div id='result_area'>
        <select name='results' id='result_area_selector'>
          <option value="none">none</option>
        </select>
        <div id='result_area_page'></div>
      </div>
    </div>
  </div>
  <!-- Tutorial Console -->
  <div id="tab-tutorial">
    <div id='content_title'>
      <h1>Interactive Tutorial</h1>
    </div>
    <div id='tutorial_left'>
      <div id='tutorial_area'>
        <div id='tutorial_history'>
          <p>Welcome to mvStore 1.0</p>
          <br>
          <p>h: print the help</p>
          <p>t: start the interactive tutorial</p>
          <p>... and don't hesitate to visit the <a href='doc/intro.html'>documentation</a>, check out this short <a href='doc/presentations/p_nutshell/nutshell.html'>presentation</a>, or <a href='doc/mvStore%20getting%20started.html#setup'>install</a>!</p> 
          <br>
        </div>
        <div id='tutorial_input_line'>&gt;<input id='tutorial_input' /></div>
      </div>
    </div>
  </div>
  <!-- Query History -->
  <div id="tab-queryhistory">
    <div id='content_title'>
      <h1>Query History</h1>
    </div>
    <div id='content_left'>
      <div id='query_history'></div>
    </div>
    <div id='content_right'>
      <button id='query_history_clear'>Clear History</button>
    </div>
  </div>
  <!-- Configuration & Administration -->
  <div id="tab-config">
    <div id='content_title'>
      <h1>Configuration &amp; Administration</h1>
    </div>
    <div id='content_left'>
      <div id='config_options'>
        <h3>Current Store Name</h3>
        <input id='storeident' name='storeident' size='25' />
        <h3>Current Store Password</h3>
        <input id='storepw' name='storepw' size='25' />
      </div>
    </div>
  </div>
</div>

<div id='bottom'>mvStore</div>

<!--
  #thetooltip is recycled throughout the whole UI, to display a tooltip wherever we want;
  #thetooltiptable and #themenutable are used as string tables; does there exist a more orthodox solution?
-->
<div id='thetooltip'>tooltip</div>
<div id='thetooltiptable'>
  <div id='manual'> <!-- These are bound manually by the js code. -->
    <div id='tooltip_tab-basic'>Basic Console</div>
    <div id='tooltip_tab-batching'>Batching Console</div>
    <div id='tooltip_tab-tutorial'>Interactive Tutorial</div>
    <div id='tooltip_tab-queryhistory'>Query History</div>
    <div id='tooltip_tab-config'>Configuration &amp; Administration</div>
  </div>
  <div id='automatic'> <!-- These are bound automatically to components of the same name in the page. -->
    <div id='tooltip_classes'>Stored Classes (Right-Click)</div>
    <div id='tooltip_class_properties'>Properties of Selected Class (Right-Click)</div>
    <div id='tooltip_qnames'>QName Prefixes</div>
    <div id='tooltip_query'>Next Query (Press 'go' or Right-Click)</div>
    <div id='tooltip_result_pin'>Last Selected PIN</div>
    <div id='tooltip_query_history'>Click or Right-Click on Row</div>
    <div id='tooltip_query_area_q'>Next Batch of Queries (Press 'go')</div>
    <div id='tooltip_result_area_selector'>Select Query Result</div>
    <div id='tooltip_storeident'>Store Name (aka Identity)</div>
    <div id='tooltip_storepw'>Store Password (may be empty)</div>
  </div>
</div>
<div id='themenutable'>
  <div id='menu_query'>
    <div id='menuitem_query_pin'>Query PIN</div>
    <div id='menuitem_query_class'>Query Class</div>
    <div id='menuitem_query_classft'>Query Class With Full-Text</div>
    <div id='menuitem_query_classjoin'>Query Class Join</div>
    <div id='menuitem_query_all'>Query All PINs</div>
    <div id='menuitem_query_insertpin'>Insert PIN</div>
    <div id='menuitem_query_insertgraph'>Insert Graph</div>
    <div id='menuitem_query_insertclass'>Insert Class</div>
    <div id='menuitem_query_updatepin'>Update PIN</div>
    <div id='menuitem_query_deletepin'>Delete PIN</div>
    <div id='menuitem_query_dropclass'>Drop Class</div>
  </div>
  <div id='menu_classes'>
    <div id='menuitem_classes_q'>Query Class</div>
    <div id='menuitem_classes_q_ft'>Query Class With Full-Text</div>
    <div id='menuitem_classes_q_drop'>Drop Class</div>
  <div id='menu_result_pin'>
    <div id='menuitem_rp_querypin'>Query PIN</div>
    <div id='menuitem_rp_deletepin'>Delete PIN</div>
  </div>
  <div id='menu_query_history'>
    <div id='menuitem_qh_remove'>Remove</div>
    <div id='menuitem_qh_setquery'>Set As Next Query</div>
  </div>
</div>
<div id='thetutorial'>
  <div id='help'>
    <div>HELP</div>
    <div>Note: This is a simplified interface for introductory purpose.</div>
    <div>&nbsp;</div>
    <div>h: print this help</div>
    <div>t: start the tutorial</div>
    <div>n: go to the next step of the tutorial</div>
    <div>step(number): jump to step 'number' of the tutorial</div>
    <div>&nbsp;</div>
    <div>pathsql(sqlstr) or q(sqlstr): execute 'sqlstr' and return json</div>
    <div>save(json): create or update objects in the db</div>
    <div>print(v): print the value of 'v'</div>
  </div>
  <div id='steps'>
    <div id='step0'>
      <div>This is a quick, simple tutorial about mvStore.</div>
      <div>Note: All examples can be cut&amp;pasted as one line, or as multiple lines.</div>
      <div>step(number): jump to step 'number'</div>
      <div>n: move forward</div>
    </div>
    <div id='step1'>
      <div>Step 1</div>
      <div>This shell provides a programming environment in javascript.</div>
      <div>It emulates what you'll experience in the language of your choice, using one of mvStore's client libraries.</div>
      <div>Try this simple object manipulation for example (we'll save this object later on):</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>object = {name:'Jack', profession:'doctor'};</div>
      <div class='tutorial_step'>for (i in object) { print(i + ":" + object[i]); }</div>
    </div>
    <div id='step2'>
      <div>Step 2</div>
      <div>The pathsql() function <i>(aka q())</i> opens up the whole sql-based side of the interaction.</div>
      <div>Try this for example:</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>pins = pathsql("INSERT name='Steve', profession='engineer';");</div>
      <div class='tutorial_step'>print("resulting pin id:" + pins[0].id);</div>
      <div class='tutorial_step'>q("SELECT * FROM @" + pins[0].id + ";");</div>
      <div class='tutorial_step'>q("SELECT * WHERE EXISTS(name) MATCH AGAINST('Ste');");</div>
    </div>
    <div id='step3'>
      <div>Step 3</div>
      <div>The pathSQL <a href='doc/pathSQL%20reference.html#dml'>DML</a> can be very compact and and powerful.</div>
      <div>Try this for example:</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>q("INSERT name='John', profession='lawyer', age=37, friends={(INSERT name='Fred', profession='musician', age=17), (INSERT name='Stephanie', profession='surgeon', age=45), (INSERT name='Claire', profession='teacher', age=67)};");</div>
      <div class='tutorial_step'>q("SELECT * WHERE EXISTS(name);");</div>
    </div>
    <div id='step4'>
      <div>Step 4</div>
      <div>Remember the plain javascript object we had created at step 1? Let's save it...</div>
      <div>Notice the new 'id' attribute after the save.</div>
      <div>Note: With our client interfaces this is achieved transparently via protocol buffers. Here the implementation is an emulation using pathSQL.</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>if (object != undefined)</div>
      <div class='tutorial_step'>&nbsp;&nbsp;{ print(object); save(object); print(object); }</div>
    </div>
    <div id='step5'>
      <div>Step 5</div>
      <div>Now that our object has an id, we can modify it.</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>if (object != undefined)</div>
      <div class='tutorial_step'>&nbsp;&nbsp;{ object.mystring = 'hello world'; object.mycollection = [1, 2, 3, 4, 5]; object.mydate = new Date(); save(object); }</div>
      <div class='tutorial_step'>q("SELECT * WHERE EXISTS(mystring);");</div>
    </div>
    <div id='step6'>
      <div>Step 6</div>
      <div>Let's take advantage of our environment to create more data easily.</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>names=['Abby', 'Bruce', 'Camille', 'Derek', 'Ed', 'Frank', 'Greg', 'Harold', 'Ivy', 'Joseph', 'Karl', 'Lynne', 'Mark', 'Nick', 'Oscar', 'Pam', 'Queen', 'Ramon', 'Steve', 'Ted', 'Ursula', 'Victor', 'Wayne', 'Xavier', 'Young', 'Zack'];</div>
      <div class='tutorial_step'>professions=['teacher', 'accompanist', 'accountant', 'actor', 'athlete', 'attorney', 'bacteriologist', 'botanist', 'conciliator', 'engineer', 'journalist', 'mathematician', 'mediator', 'meteorologist', 'salesman'];</div>
      <div class='tutorial_step'>pickFrom = function(array) { return array[Math.floor(Math.random() * array.length)]; };</div>
      <div class='tutorial_step'>for (i = 0; i &lt; 15; i++) { save({name:pickFrom(names), age:Math.random()*100, profession:pickFrom(professions)}); }</div>
    </div>
    <div id='step7'>
      <div>Step 7</div>
      <div>Now that we have some data, how about we organize it a little bit?</div>
      <div>Try this:</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>q("CREATE CLASS workers AS SELECT * WHERE EXISTS(name) AND profession IN :0;");</div>
      <div class='tutorial_step'>q("SELECT * FROM workers;");</div>
      <div class='tutorial_step'>q("SELECT * FROM workers('musician');");</div>
      <div class='tutorial_step'>q("SELECT * FROM workers(['l', 'n']);");</div>
      <div class='tutorial_step'>q("CREATE CLASS people AS SELECT * WHERE name IN :0;");</div>
      <div class='tutorial_step'>q("SELECT * FROM people(['A', 'G']);");</div>
    </div>
    <div id='step8'>
      <div>Step 8</div>
      <div>Let's create more friendships:</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>pins = q("SELECT mv:pinID FROM workers;");</div>
      <div class='tutorial_step'>pickFriend = function() { return Math.floor(Math.random() * pins.length); };</div>
      <div class='tutorial_step'>for (i = 0; i &lt; 30; i++) { from = pickFriend(); to = pickFriend(); if (pins[from].id != pins[to].id) q("UPDATE @" + pins[from].id + " ADD friends=@" + pins[to].id + " WHERE (NOT (@" + pins[to].id + " = @.friends));"); }</div>
    </div>
    <div id='step9'>
      <div>Step 9</div>
      <div>Let's attach a different kind of data to the small network generated so far:</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>colors=['amber', 'beige', 'carmine', 'denim', 'emerald', 'fuchsia', 'gold', 'ivory', 'jade', 'khaki', 'lapis lazuli', 'magenta', 'orange', 'pink', 'red', 'salmon', 'turquoise', 'vermilion', 'white', 'yellow'];</div>
      <div class='tutorial_step'>makes=['Audi', 'Bentley', 'DaimlerChrysler', 'Ferrari', 'GM', 'Honda', 'Jaguar', 'KIA', 'Lamborghini', 'Maserati', 'Nissan', 'Porsche', 'Rolls-Royce', 'Suzuki', 'Toyota', 'Volvo'];</div>
      <div class='tutorial_step'>pins = q("SELECT mv:pinID FROM workers;");</div>
      <div class='tutorial_step'>pickFrom = function(array) { return array[Math.floor(Math.random() * array.length)]; };</div>
      <div class='tutorial_step'>for (i = 0; i &lt; pins.length; i++) { q("UPDATE @" + pickFrom(pins).id + " ADD car=(INSERT car_make='" + pickFrom(makes) + "', color='" + pickFrom(colors) + "', year='" + (1950 + Math.floor(Math.random() * 62)) + "');"); }</div>
      <div class='tutorial_step'>q("CREATE CLASS cars AS SELECT * WHERE EXISTS(car_make);")</div>
    </div>
    <div id='step10'>
      <div>Step 10</div>
      <div>Path expressions provide a sophisticated means of navigating graphs.</div>
      <div>Here are a few simple examples:</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>friends = q("SELECT * FROM workers.friends;");</div>
      <div class='tutorial_step'>for (i = 0; i &lt; friends.length; i++) print("friend of a worker: " + friends[i].name + " (" + friends[i].id + ")");</div>
      <div class='tutorial_step'>q("SELECT * FROM workers('mathematician').friends.friends.friends;");</div>
      <div class='tutorial_step'>q("SELECT name, profession FROM workers(['d', 'n']).friends[age &gt; 10 AND age &lt; 50].friends;");</div>
      <div class='tutorial_step'>q("SELECT * FROM people(['A', 'J']).friends[SUBSTR(name, 0, 1) IN ['A', 'J']];");</div>
      <div class='tutorial_step'>q("SELECT * FROM workers(['d', 'n']).friends{*}[age &lt; 50];");</div>
      <div class='tutorial_step'>q("SELECT * FROM workers(['d', 'n']).friends{*}.car[year IN [1980, 2000]];");</div>
    </div>
    <div id='step11'>
      <div>Step 11</div>
      <div>Good old JOINs are also available.</div>
      <div>They can be useful to connect relational schema with graphs.</div>
      <div>&nbsp;</div>
      <div class='tutorial_step'>q("SELECT * FROM cars AS c JOIN workers(['d', 'n']) AS w ON (c.mv:pinID = w.car) WHERE (c.year IN [1980, 2000]);");</div>
    </div>
  </div>
  <div id='restart'>End of tutorial.<br>Type t to restart.<br>Or check out the 'Basic Console' tab, for more fun.<br>Or go and <a href='doc/mvStore%20getting%20started.html#setup'>install</a> mvStore!</div>
</div>
</body>
</html>
